import{d as vt,m as g,i as c,x as X,a as m,o as i,f as s,e as l,j as M,k as j,w as a,u as e,N as k,O as U,t as n,g as u,_ as I,S as _t,M as xt,a5 as gt,a0 as yt}from"./index-Cq09uyUw.js";import{b as wt,_ as v,a as _}from"./EntityHeader.vue_vue_type_script_setup_true_lang-DaY23PJ3.js";import{a as S,b as E,_ as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-D4zeA_Ws.js";import{_ as Y,a as Z,b as tt,c as et,d as L}from"./SelectValue.vue_vue_type_script_setup_true_lang-C04wA-zB.js";import{_ as $t,a as st,b as C,c as bt,d as D,e as kt}from"./TableHeader.vue_vue_type_script_setup_true_lang-JG1VgffO.js";import{u as Ct,_ as Dt,a as f,b as at,c as Vt,d as Tt}from"./useApi-DOmXv-cY.js";import{_ as St,a as At,b as Lt}from"./index-CNUSOQzl.js";import{_ as Ft,a as B}from"./ToggleGroupItem.vue_vue_type_script_setup_true_lang-k2m-ynEa.js";import{_ as ht,g as Rt,h as Mt,j as Ut,k as Bt}from"./SheetTitle.vue_vue_type_script_setup_true_lang-DyyP2rqd.js";import{_ as Nt}from"./index-Dqndwl6j.js";import{D as jt}from"./download-BFgBLymx.js";import{L as It}from"./list-filter-DPB2wiSz.js";import"./VisuallyHidden-CoIEhRBi.js";import"./RovingFocusItem-CCIoWk3_.js";import"./VisuallyHiddenInput-B5nBr247.js";const Et={class:"space-y-6"},zt={class:"flex flex-wrap items-center gap-4"},Ot={class:"relative flex-1 min-w-64"},Pt={class:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4"},qt={key:0,class:"p-4 space-y-4"},Gt={class:"flex items-center gap-3"},Qt={class:"space-y-2"},Ht={class:"font-medium text-foreground"},Jt={class:"text-xs"},Kt={class:"font-medium"},Wt={class:"text-xs text-muted-foreground"},Xt={key:1,class:"py-16"},Yt={key:1,class:"flex items-center justify-between"},Zt={class:"text-sm text-muted-foreground"},te={key:0,class:"flex h-full flex-col"},ee={class:"text-xs text-muted-foreground"},se={class:"text-xs font-mono"},ae={class:"mt-6 space-y-6 overflow-y-auto pr-2"},le={class:"text-sm font-medium"},oe={class:"text-xs text-muted-foreground"},ne={class:"text-sm font-medium"},ue={class:"text-sm font-medium"},de={class:"text-xs text-muted-foreground"},re={class:"text-sm font-mono"},ie={class:"text-sm font-medium"},me={class:"text-sm font-medium"},fe={class:"text-sm font-medium"},ce={class:"text-sm font-medium"},pe={class:"text-sm font-medium"},ve={class:"text-sm font-medium"},_e={class:"text-sm font-medium"},xe={class:"text-sm font-medium"},F=10,Me=vt({__name:"TransactionsPage",setup(ge){const V=g("30d"),y=g("all"),w=g("all"),T=g(""),$=g(1),h=g(!1),r=g(null),{data:lt,loading:z,error:O}=Ct(()=>Tt.transactions.list()),P=c(()=>lt.value??[]),ot=c(()=>{const d=new Set;return P.value.forEach(t=>d.add(t.app)),Array.from(d).sort()}),R=c(()=>{const d=T.value.trim().toLowerCase(),t=it(V.value);return P.value.filter(o=>{const x=d?o.merchant.name.toLowerCase().includes(d)||o.merchant.dba.toLowerCase().includes(d)||o.merchant.mid.toLowerCase().includes(d)||o.authCode.toLowerCase().includes(d)||o.cardBrand.toLowerCase().includes(d):!0,N=y.value==="all"||o.status===y.value,W=w.value==="all"||o.app===w.value,pt=t?new Date(o.timestamp)>=t:!0;return x&&N&&W&&pt})}),p=c(()=>R.value.length),q=c(()=>R.value.filter(d=>d.status==="approved").length),nt=c(()=>R.value.reduce((d,t)=>d+t.amount,0)),ut=c(()=>p.value?`${(q.value/p.value*100).toFixed(1)}%`:"—"),G=c(()=>{const d=($.value-1)*F;return R.value.slice(d,d+F)}),dt=c(()=>p.value?($.value-1)*F+1:0),rt=c(()=>Math.min($.value*F,p.value));X([T,y,w,V],()=>{$.value=1}),X(h,d=>{d||(r.value=null)});function it(d){const t=new Date,o=d==="7d"?7:d==="30d"?30:90,x=new Date(t);return x.setDate(t.getDate()-o),x}function b(d){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d)}function Q(d){return new Intl.DateTimeFormat("en",{dateStyle:"medium",timeStyle:"short"}).format(new Date(d))}function mt(d){const t=new Date(d),o=new Date,x=t.getTime()-o.getTime(),N=Math.round(x/(1e3*60*60*24));return new Intl.RelativeTimeFormat("en",{numeric:"auto"}).format(N,"day")}function H(d){switch(d){case"approved":return"success";case"declined":return"danger";case"refunded":return"info";default:return"info"}}function J(d){return d.charAt(0).toUpperCase()+d.slice(1)}function ft(d){r.value=d,h.value=!0}function K(){T.value="",y.value="all",w.value="all",V.value="30d"}function ct(){yt.success("Export started",{description:"A CSV export of transactions is being prepared in the background."})}return(d,t)=>(i(),m("div",Et,[s(wt,{title:"Transactions",description:"Portfolio-level transaction summary"},{actions:a(()=>[s(e(Y),{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o)},{default:a(()=>[s(e(Z),{class:"w-40"},{default:a(()=>[s(e(tt),{placeholder:"Date range"})]),_:1}),s(e(et),null,{default:a(()=>[s(e(L),{value:"7d"},{default:a(()=>[...t[6]||(t[6]=[u("Last 7 days",-1)])]),_:1}),s(e(L),{value:"30d"},{default:a(()=>[...t[7]||(t[7]=[u("Last 30 days",-1)])]),_:1}),s(e(L),{value:"90d"},{default:a(()=>[...t[8]||(t[8]=[u("Last 90 days",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(e(Y),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=o=>w.value=o)},{default:a(()=>[s(e(Z),{class:"w-44"},{default:a(()=>[s(e(tt),{placeholder:"All apps"})]),_:1}),s(e(et),null,{default:a(()=>[s(e(L),{value:"all"},{default:a(()=>[...t[9]||(t[9]=[u("All Apps",-1)])]),_:1}),(i(!0),m(k,null,U(ot.value,o=>(i(),M(e(L),{key:o,value:o},{default:a(()=>[u(n(o),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(e(Ft),{type:"single",modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=o=>y.value=o),class:"bg-muted/40 rounded-md border border-border/60"},{default:a(()=>[s(e(B),{value:"all",class:"px-3 py-1.5 text-xs font-medium uppercase tracking-wide"},{default:a(()=>[...t[10]||(t[10]=[u(" All ",-1)])]),_:1}),s(e(B),{value:"approved",class:"px-3 py-1.5 text-xs font-medium uppercase tracking-wide"},{default:a(()=>[...t[11]||(t[11]=[u(" Approved ",-1)])]),_:1}),s(e(B),{value:"declined",class:"px-3 py-1.5 text-xs font-medium uppercase tracking-wide"},{default:a(()=>[...t[12]||(t[12]=[u(" Declined ",-1)])]),_:1}),s(e(B),{value:"refunded",class:"px-3 py-1.5 text-xs font-medium uppercase tracking-wide"},{default:a(()=>[...t[13]||(t[13]=[u(" Refunded ",-1)])]),_:1})]),_:1},8,["modelValue"]),s(e(I),{variant:"outline",onClick:ct},{default:a(()=>[s(e(jt),{class:"mr-2 h-4 w-4"}),t[14]||(t[14]=u(" Export CSV ",-1))]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(_),null,{default:a(()=>[l("div",zt,[l("div",Ot,[s(e(_t),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(e(xt),{modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=o=>T.value=o),type:"search",placeholder:"Search by merchant, MID, auth code, or card brand",class:"pl-9"},null,8,["modelValue"])]),s(e(I),{variant:"ghost",size:"sm",onClick:K},{default:a(()=>[s(e(It),{class:"mr-2 h-4 w-4"}),t[15]||(t[15]=u(" Reset filters ",-1))]),_:1})])]),_:1})]),_:1}),l("div",Pt,[e(z)?(i(),m(k,{key:0},U(3,o=>s(e(v),{key:o,class:"card-compact"},{default:a(()=>[s(e(_),{class:"py-4 space-y-2"},{default:a(()=>[s(e(f),{class:"h-4 w-24"}),s(e(f),{class:"h-6 w-32"})]),_:1})]),_:1})),64)):(i(),m(k,{key:1},[s(e(v),{class:"card-compact"},{default:a(()=>[s(e(S),{class:"pb-2"},{default:a(()=>[s(e(E),null,{default:a(()=>[...t[16]||(t[16]=[u("Total Transactions",-1)])]),_:1}),s(e(A),{class:"text-2xl"},{default:a(()=>[u(n(p.value.toLocaleString()),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[...t[17]||(t[17]=[u(" Across selected filters ",-1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(S),{class:"pb-2"},{default:a(()=>[s(e(E),null,{default:a(()=>[...t[18]||(t[18]=[u("Total Volume",-1)])]),_:1}),s(e(A),{class:"text-2xl"},{default:a(()=>[u(n(b(nt.value)),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[...t[19]||(t[19]=[u(" Gross captured amount ",-1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(S),{class:"pb-2"},{default:a(()=>[s(e(E),null,{default:a(()=>[...t[20]||(t[20]=[u("Approval Rate",-1)])]),_:1}),s(e(A),{class:"text-2xl"},{default:a(()=>[u(n(ut.value),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[u(n(q.value)+" of "+n(p.value)+" approved ",1)]),_:1})]),_:1})],64))]),e(O)?(i(),M(e(St),{key:0,variant:"destructive"},{default:a(()=>[s(e(At),null,{default:a(()=>[...t[21]||(t[21]=[u("Failed to load transactions",-1)])]),_:1}),s(e(Lt),null,{default:a(()=>[u(n(e(O)),1)]),_:1})]),_:1})):j("",!0),s(e(v),null,{default:a(()=>[e(z)?(i(),m("div",qt,[l("div",Gt,[s(e(f),{class:"h-4 w-24"}),s(e(f),{class:"h-4 w-20"}),s(e(f),{class:"h-4 w-16 ml-auto"})]),l("div",Qt,[(i(),m(k,null,U(8,o=>l("div",{key:o,class:"grid grid-cols-12 items-center gap-4 py-3"},[s(e(f),{class:"col-span-2 h-4"}),s(e(f),{class:"col-span-3 h-4"}),s(e(f),{class:"col-span-2 h-4"}),s(e(f),{class:"col-span-2 h-6 rounded-full"}),s(e(f),{class:"col-span-2 h-4"}),s(e(f),{class:"col-span-1 h-4 justify-self-end"})])),64))])])):(i(),m(k,{key:1},[G.value.length?(i(),M(e(kt),{key:0,class:"table-compact","container-class":"px-4"},{default:a(()=>[s(e($t),null,{default:a(()=>[s(e(st),null,{default:a(()=>[s(e(C),null,{default:a(()=>[...t[22]||(t[22]=[u("Time",-1)])]),_:1}),s(e(C),null,{default:a(()=>[...t[23]||(t[23]=[u("Merchant",-1)])]),_:1}),s(e(C),null,{default:a(()=>[...t[24]||(t[24]=[u("Amount",-1)])]),_:1}),s(e(C),null,{default:a(()=>[...t[25]||(t[25]=[u("Status",-1)])]),_:1}),s(e(C),null,{default:a(()=>[...t[26]||(t[26]=[u("Auth Code",-1)])]),_:1}),s(e(C),null,{default:a(()=>[...t[27]||(t[27]=[u("Card Brand",-1)])]),_:1})]),_:1})]),_:1}),s(e(bt),null,{default:a(()=>[(i(!0),m(k,null,U(G.value,o=>(i(),M(e(st),{key:o.id,class:"cursor-pointer transition hover:bg-accent/30",onClick:x=>ft(o)},{default:a(()=>[s(e(D),{class:"text-sm text-muted-foreground"},{default:a(()=>[l("div",Ht,n(Q(o.timestamp)),1),l("div",Jt,n(mt(o.timestamp)),1)]),_:2},1024),s(e(D),null,{default:a(()=>[l("div",Kt,n(o.merchant.name),1),l("div",Wt,n(o.merchant.dba)+" • "+n(o.merchant.mid),1)]),_:2},1024),s(e(D),{class:"font-mono"},{default:a(()=>[u(n(b(o.amount)),1)]),_:2},1024),s(e(D),null,{default:a(()=>[s(at,{variant:H(o.status)},{default:a(()=>[u(n(J(o.status)),1)]),_:2},1032,["variant"])]),_:2},1024),s(e(D),{class:"font-mono text-sm"},{default:a(()=>[u(n(o.authCode),1)]),_:2},1024),s(e(D),null,{default:a(()=>[s(e(Nt),{variant:"outline"},{default:a(()=>[u(n(o.cardBrand),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):(i(),m("div",Xt,[s(Vt,{title:"No transactions found",description:"Try a different combination of filters or adjust the date range.",icon:e(gt)},{actions:a(()=>[s(e(I),{variant:"outline",onClick:K},{default:a(()=>[...t[28]||(t[28]=[u("Reset Filters",-1)])]),_:1})]),_:1},8,["icon"])]))],64))]),_:1}),p.value?(i(),m("div",Yt,[l("div",Zt," Showing "+n(dt.value)+" to "+n(rt.value)+" of "+n(p.value)+" transactions ",1),s(e(Dt),{total:p.value,"items-per-page":F,page:$.value,"onUpdate:page":t[4]||(t[4]=o=>$.value=o)},null,8,["total","page"])])):j("",!0),s(e(ht),{open:h.value,"onUpdate:open":t[5]||(t[5]=o=>h.value=o)},{default:a(()=>[s(e(Rt),{class:"sm:max-w-2xl"},{default:a(()=>[r.value?(i(),m("div",te,[s(e(Mt),{class:"space-y-2 text-left"},{default:a(()=>[s(e(Ut),null,{default:a(()=>[u(n(b(r.value.amount)),1)]),_:1}),s(e(Bt),{class:"flex flex-wrap items-center gap-2"},{default:a(()=>[s(at,{variant:H(r.value.status)},{default:a(()=>[u(n(J(r.value.status)),1)]),_:1},8,["variant"]),l("span",ee,n(Q(r.value.timestamp)),1),t[29]||(t[29]=l("span",{class:"text-xs text-muted-foreground"},"•",-1)),l("span",se,n(r.value.id),1)]),_:1})]),_:1}),l("div",ae,[s(e(v),{class:"card-compact"},{default:a(()=>[s(e(_),{class:"py-4 grid gap-3 sm:grid-cols-2"},{default:a(()=>[l("div",null,[t[30]||(t[30]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Merchant",-1)),l("div",le,n(r.value.merchant.name),1),l("div",oe,n(r.value.merchant.dba)+" • "+n(r.value.merchant.mid),1)]),l("div",null,[t[31]||(t[31]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Application",-1)),l("div",ne,n(r.value.app),1)]),l("div",null,[t[32]||(t[32]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Card",-1)),l("div",ue,n(r.value.cardBrand)+" • "+n(r.value.cardType),1),l("div",de,"•••• "+n(r.value.cardLast4),1)]),l("div",null,[t[33]||(t[33]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Auth Code",-1)),l("div",re,n(r.value.authCode),1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(S),{class:"pb-2"},{default:a(()=>[s(e(A),{class:"text-base"},{default:a(()=>[...t[34]||(t[34]=[u("Financials",-1)])]),_:1})]),_:1}),s(e(_),{class:"grid gap-4 sm:grid-cols-2"},{default:a(()=>[l("div",null,[t[35]||(t[35]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Gross Amount",-1)),l("div",ie,n(b(r.value.amount)),1)]),l("div",null,[t[36]||(t[36]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Fees",-1)),l("div",me,n(b(r.value.fees)),1)]),l("div",null,[t[37]||(t[37]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Net",-1)),l("div",fe,n(b(r.value.net)),1)]),l("div",null,[t[38]||(t[38]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Risk Score",-1)),l("div",ce,n(r.value.riskScore),1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(S),{class:"pb-2"},{default:a(()=>[s(e(A),{class:"text-base"},{default:a(()=>[...t[39]||(t[39]=[u("Additional Details",-1)])]),_:1})]),_:1}),s(e(_),{class:"grid gap-4 sm:grid-cols-2"},{default:a(()=>[l("div",null,[t[40]||(t[40]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Channel",-1)),l("div",pe,n(r.value.channel),1)]),l("div",null,[t[41]||(t[41]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Entry Mode",-1)),l("div",ve,n(r.value.entryMode),1)]),l("div",null,[t[42]||(t[42]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Descriptor",-1)),l("div",_e,n(r.value.statementDescriptor),1)]),l("div",null,[t[43]||(t[43]=l("div",{class:"text-xs text-muted-foreground uppercase"},"Location",-1)),l("div",xe,n(r.value.location),1)])]),_:1})]),_:1})])])):j("",!0)]),_:1})]),_:1},8,["open"])]))}});export{Me as default};
