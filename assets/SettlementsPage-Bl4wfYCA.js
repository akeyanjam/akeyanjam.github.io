import{d as gt,j as g,a as c,V as tt,h as f,o as i,e as s,g as n,b as C,i as P,w as a,u as e,F as y,k as T,t as d,f as o,m as M,S as yt,G as wt,$ as $t,a0 as bt,R as et}from"./index-6xlqELlD.js";import{b as kt,_ as v,a as _}from"./EntityHeader.vue_vue_type_script_setup_true_lang-CAtsaN7F.js";import{a as w,b as j,_ as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-hwoaRCTa.js";import{_ as E,a as O,b as z,c as G,d as b}from"./SelectValue.vue_vue_type_script_setup_true_lang-Ck1m-3qh.js";import{_ as Dt,a as st,b as k,c as St,d as D,e as Ft}from"./TableHeader.vue_vue_type_script_setup_true_lang-BdWTU7p7.js";import{u as Vt,_ as Ct,a as p,b as at,c as ht,d as At}from"./useApi-BNdd-B_u.js";import{_ as Lt,a as Nt,b as Tt}from"./index-CJIjmB6t.js";import{_ as Mt,g as Ut,h as Rt,j as Pt,k as Bt}from"./SheetTitle.vue_vue_type_script_setup_true_lang-sLGFPffH.js";import{_ as It}from"./index-Dbn-_OPZ.js";import{D as jt}from"./download-sOrNCYN4.js";import{L as Et}from"./list-filter-BLgUJPaQ.js";import"./VisuallyHidden-B8DorUYk.js";const Ot={class:"space-y-6"},zt={class:"flex flex-wrap items-center gap-4"},Gt={class:"relative flex-1 min-w-64"},Ht={class:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4"},qt={key:0,class:"p-4 space-y-4"},Qt={class:"flex items-center gap-3"},Jt={class:"space-y-2"},Kt={class:"font-medium"},Wt={class:"text-xs text-muted-foreground"},Xt={class:"font-medium"},Yt={class:"text-xs text-muted-foreground"},Zt={key:1,class:"py-16"},te={key:1,class:"flex items-center justify-between"},ee={class:"text-sm text-muted-foreground"},se={key:0,class:"flex h-full flex-col"},ae={class:"text-xs text-muted-foreground"},le={class:"text-xs text-muted-foreground"},ne={class:"mt-6 space-y-6 overflow-y-auto pr-2"},ue={class:"text-sm font-medium"},oe={class:"text-xs text-muted-foreground"},de={class:"text-sm font-medium"},re={class:"text-sm font-medium"},ie={class:"text-sm font-medium"},fe={class:"text-sm font-medium"},me={class:"text-sm font-medium"},ce={class:"text-sm font-medium"},pe={class:"text-sm font-medium"},ve={class:"text-sm font-medium"},_e={class:"text-sm font-medium"},xe={class:"text-sm text-muted-foreground"},ge={class:"mt-3 flex items-center gap-2 text-xs text-muted-foreground"},U=10,Ne=gt({__name:"SettlementsPage",setup(ye){const h=g("30d"),S=g("all"),F=g("all"),A=g(""),V=g(1),R=g(!1),r=g(null),{data:lt,loading:H,error:q}=Vt(()=>At.settlements.list()),B=c(()=>lt.value??[]),nt=c(()=>{const u=new Set;return B.value.forEach(t=>u.add(t.app)),Array.from(u).sort()}),ut=c(()=>{const u=new Set;return B.value.forEach(t=>u.add(t.merchant.name)),Array.from(u).sort()}),L=c(()=>{const u=A.value.trim().toLowerCase(),t=mt(h.value);return B.value.filter(l=>{const x=u?l.merchant.name.toLowerCase().includes(u)||l.merchant.dba.toLowerCase().includes(u)||l.merchant.mid.toLowerCase().includes(u)||l.statementUrl&&l.statementUrl.toLowerCase().includes(u)||l.notes&&l.notes.toLowerCase().includes(u):!0,I=S.value==="all"||l.app===S.value,Z=F.value==="all"||l.merchant.name===F.value,xt=t?new Date(l.batchDate)>=t:!0;return x&&I&&Z&&xt})}),N=c(()=>L.value.length),ot=c(()=>L.value.filter(u=>u.status==="funded").reduce((u,t)=>u+t.net,0)),dt=c(()=>L.value.reduce((u,t)=>u+t.fees,0)),rt=c(()=>L.value.reduce((u,t)=>u+t.net,0)),Q=c(()=>{const u=(V.value-1)*U;return L.value.slice(u,u+U)}),it=c(()=>N.value?(V.value-1)*U+1:0),ft=c(()=>Math.min(V.value*U,N.value));tt([S,F,A,h],()=>{V.value=1}),tt(R,u=>{u||(r.value=null)});function mt(u){const t=new Date,l=u==="7d"?7:u==="30d"?30:90,x=new Date(t);return x.setDate(t.getDate()-l),x}function m(u){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(u)}function J(u){return new Intl.DateTimeFormat("en",{dateStyle:"medium"}).format(new Date(u))}function ct(u){return new Intl.DateTimeFormat("en",{dateStyle:"medium",timeStyle:"short"}).format(new Date(u))}function pt(u){const t=new Date(u),l=new Date,x=t.getTime()-l.getTime(),I=Math.round(x/(1e3*60*60*24));return new Intl.RelativeTimeFormat("en",{numeric:"auto"}).format(I,"day")}function K(u){switch(u){case"funded":return"success";case"pending":return"warning";case"hold":return"danger";default:return"info"}}function W(u){switch(u){case"funded":return"Funded";case"pending":return"Pending";case"hold":return"On Hold";default:return u}}function X(){A.value="",h.value="30d",S.value="all",F.value="all"}function vt(u){r.value=u,R.value=!0}function Y(u){et.info("Statement opened",{description:"A statement preview would open in a new tab in production."})}function _t(){et.success("Export started",{description:"Preparing your settlement CSV in the background."})}return(u,t)=>(i(),f("div",Ot,[s(kt,{title:"Settlements",description:"Funding and settlement overview"},{actions:a(()=>[s(e(E),{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=l=>h.value=l)},{default:a(()=>[s(e(O),{class:"w-40"},{default:a(()=>[s(e(z),{placeholder:"Date range"})]),_:1}),s(e(G),null,{default:a(()=>[s(e(b),{value:"7d"},{default:a(()=>[...t[7]||(t[7]=[o("Last 7 days",-1)])]),_:1}),s(e(b),{value:"30d"},{default:a(()=>[...t[8]||(t[8]=[o("Last 30 days",-1)])]),_:1}),s(e(b),{value:"90d"},{default:a(()=>[...t[9]||(t[9]=[o("Last 90 days",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(e(E),{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=l=>S.value=l)},{default:a(()=>[s(e(O),{class:"w-44"},{default:a(()=>[s(e(z),{placeholder:"All apps"})]),_:1}),s(e(G),null,{default:a(()=>[s(e(b),{value:"all"},{default:a(()=>[...t[10]||(t[10]=[o("All Apps",-1)])]),_:1}),(i(!0),f(y,null,T(nt.value,l=>(i(),C(e(b),{key:l,value:l},{default:a(()=>[o(d(l),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(e(E),{modelValue:F.value,"onUpdate:modelValue":t[2]||(t[2]=l=>F.value=l)},{default:a(()=>[s(e(O),{class:"w-52"},{default:a(()=>[s(e(z),{placeholder:"All merchants"})]),_:1}),s(e(G),null,{default:a(()=>[s(e(b),{value:"all"},{default:a(()=>[...t[11]||(t[11]=[o("All Merchants",-1)])]),_:1}),(i(!0),f(y,null,T(ut.value,l=>(i(),C(e(b),{key:l,value:l},{default:a(()=>[o(d(l),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(e(M),{variant:"outline",onClick:_t},{default:a(()=>[s(e(jt),{class:"mr-2 h-4 w-4"}),t[12]||(t[12]=o(" Export CSV ",-1))]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(_),null,{default:a(()=>[n("div",zt,[n("div",Gt,[s(e(yt),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(e(wt),{modelValue:A.value,"onUpdate:modelValue":t[3]||(t[3]=l=>A.value=l),type:"search",placeholder:"Search by merchant, MID, statement, or notes",class:"pl-9"},null,8,["modelValue"])]),s(e(M),{variant:"ghost",size:"sm",onClick:X},{default:a(()=>[s(e(Et),{class:"mr-2 h-4 w-4"}),t[13]||(t[13]=o(" Reset filters ",-1))]),_:1})])]),_:1})]),_:1}),n("div",Ht,[e(H)?(i(),f(y,{key:0},T(3,l=>s(e(v),{key:l,class:"card-compact"},{default:a(()=>[s(e(_),{class:"py-4 space-y-2"},{default:a(()=>[s(e(p),{class:"h-4 w-24"}),s(e(p),{class:"h-6 w-32"})]),_:1})]),_:1})),64)):(i(),f(y,{key:1},[s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e(j),null,{default:a(()=>[...t[14]||(t[14]=[o("Total Funded",-1)])]),_:1}),s(e($),{class:"text-2xl"},{default:a(()=>[o(d(m(ot.value)),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[...t[15]||(t[15]=[o(" Net deposits completed in range ",-1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e(j),null,{default:a(()=>[...t[16]||(t[16]=[o("Total Fees",-1)])]),_:1}),s(e($),{class:"text-2xl"},{default:a(()=>[o(d(m(dt.value)),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[...t[17]||(t[17]=[o(" Fees associated with batches ",-1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e(j),null,{default:a(()=>[...t[18]||(t[18]=[o("Net Payout",-1)])]),_:1}),s(e($),{class:"text-2xl"},{default:a(()=>[o(d(m(rt.value)),1)]),_:1})]),_:1}),s(e(_),{class:"pt-0 text-xs text-muted-foreground"},{default:a(()=>[...t[19]||(t[19]=[o(" After reserves and fees ",-1)])]),_:1})]),_:1})],64))]),e(q)?(i(),C(e(Lt),{key:0,variant:"destructive"},{default:a(()=>[s(e(Nt),null,{default:a(()=>[...t[20]||(t[20]=[o("Failed to load settlements",-1)])]),_:1}),s(e(Tt),null,{default:a(()=>[o(d(e(q)),1)]),_:1})]),_:1})):P("",!0),s(e(v),null,{default:a(()=>[e(H)?(i(),f("div",qt,[n("div",Qt,[s(e(p),{class:"h-4 w-24"}),s(e(p),{class:"h-4 w-20"}),s(e(p),{class:"h-4 w-16 ml-auto"})]),n("div",Jt,[(i(),f(y,null,T(6,l=>n("div",{key:l,class:"grid grid-cols-12 items-center gap-4 py-3"},[s(e(p),{class:"col-span-2 h-4"}),s(e(p),{class:"col-span-3 h-4"}),s(e(p),{class:"col-span-2 h-4"}),s(e(p),{class:"col-span-2 h-4"}),s(e(p),{class:"col-span-2 h-4"}),s(e(p),{class:"col-span-1 h-6 rounded-full"})])),64))])])):(i(),f(y,{key:1},[Q.value.length?(i(),C(e(Ft),{key:0,class:"table-compact","container-class":"px-4"},{default:a(()=>[s(e(Dt),null,{default:a(()=>[s(e(st),null,{default:a(()=>[s(e(k),null,{default:a(()=>[...t[21]||(t[21]=[o("Batch Date",-1)])]),_:1}),s(e(k),null,{default:a(()=>[...t[22]||(t[22]=[o("Merchant",-1)])]),_:1}),s(e(k),null,{default:a(()=>[...t[23]||(t[23]=[o("Gross",-1)])]),_:1}),s(e(k),null,{default:a(()=>[...t[24]||(t[24]=[o("Fees",-1)])]),_:1}),s(e(k),null,{default:a(()=>[...t[25]||(t[25]=[o("Net",-1)])]),_:1}),s(e(k),null,{default:a(()=>[...t[26]||(t[26]=[o("Status",-1)])]),_:1}),s(e(k),{class:"text-right"},{default:a(()=>[...t[27]||(t[27]=[o("Statement",-1)])]),_:1})]),_:1})]),_:1}),s(e(St),null,{default:a(()=>[(i(!0),f(y,null,T(Q.value,l=>(i(),C(e(st),{key:l.id,class:"cursor-pointer transition hover:bg-accent/5",onClick:x=>vt(l)},{default:a(()=>[s(e(D),null,{default:a(()=>[n("div",Kt,d(J(l.batchDate)),1),n("div",Wt,d(pt(l.batchDate)),1)]),_:2},1024),s(e(D),null,{default:a(()=>[n("div",Xt,d(l.merchant.name),1),n("div",Yt,d(l.merchant.dba)+" â€¢ "+d(l.merchant.mid),1)]),_:2},1024),s(e(D),{class:"font-mono"},{default:a(()=>[o(d(m(l.gross)),1)]),_:2},1024),s(e(D),{class:"font-mono"},{default:a(()=>[o(d(m(l.fees)),1)]),_:2},1024),s(e(D),{class:"font-mono"},{default:a(()=>[o(d(m(l.net)),1)]),_:2},1024),s(e(D),null,{default:a(()=>[s(at,{variant:K(l.status)},{default:a(()=>[o(d(W(l.status)),1)]),_:2},1032,["variant"])]),_:2},1024),s(e(D),{class:"text-right"},{default:a(()=>[s(e(M),{variant:"ghost",size:"sm",onClick:$t(x=>Y(l),["stop"])},{default:a(()=>[...t[28]||(t[28]=[o(" View ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):(i(),f("div",Zt,[s(ht,{title:"No settlements found",description:"Try adjusting your filters or expand the date range.",icon:e(bt)},{actions:a(()=>[s(e(M),{variant:"outline",onClick:X},{default:a(()=>[...t[29]||(t[29]=[o("Reset Filters",-1)])]),_:1})]),_:1},8,["icon"])]))],64))]),_:1}),N.value?(i(),f("div",te,[n("div",ee," Showing "+d(it.value)+" to "+d(ft.value)+" of "+d(N.value)+" settlements ",1),s(e(Ct),{total:N.value,"items-per-page":U,page:V.value,"onUpdate:page":t[4]||(t[4]=l=>V.value=l)},null,8,["total","page"])])):P("",!0),s(e(Mt),{open:R.value,"onUpdate:open":t[6]||(t[6]=l=>R.value=l)},{default:a(()=>[s(e(Ut),{class:"sm:max-w-2xl"},{default:a(()=>[r.value?(i(),f("div",se,[s(e(Rt),{class:"space-y-2 text-left"},{default:a(()=>[s(e(Pt),null,{default:a(()=>[o(d(m(r.value.net)),1)]),_:1}),s(e(Bt),{class:"flex flex-wrap items-center gap-2"},{default:a(()=>[s(at,{variant:K(r.value.status)},{default:a(()=>[o(d(W(r.value.status)),1)]),_:1},8,["variant"]),n("span",ae,"Batch "+d(r.value.id),1),t[30]||(t[30]=n("span",{class:"text-xs text-muted-foreground"},"â€¢",-1)),n("span",le,d(J(r.value.batchDate)),1)]),_:1})]),_:1}),n("div",ne,[s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e($),{class:"text-base"},{default:a(()=>[...t[31]||(t[31]=[o("Merchant",-1)])]),_:1})]),_:1}),s(e(_),{class:"grid gap-3 sm:grid-cols-2"},{default:a(()=>[n("div",null,[t[32]||(t[32]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Merchant",-1)),n("div",ue,d(r.value.merchant.name),1),n("div",oe,d(r.value.merchant.dba)+" â€¢ "+d(r.value.merchant.mid),1)]),n("div",null,[t[33]||(t[33]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Application",-1)),n("div",de,d(r.value.app),1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e($),{class:"text-base"},{default:a(()=>[...t[34]||(t[34]=[o("Funding Summary",-1)])]),_:1})]),_:1}),s(e(_),{class:"grid gap-4 sm:grid-cols-2"},{default:a(()=>[n("div",null,[t[35]||(t[35]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Gross",-1)),n("div",re,d(m(r.value.gross)),1)]),n("div",null,[t[36]||(t[36]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Fees",-1)),n("div",ie,d(m(r.value.fees)),1)]),n("div",null,[t[37]||(t[37]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Reserves",-1)),n("div",fe,d(m(r.value.reserve)),1)]),n("div",null,[t[38]||(t[38]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Net Payout",-1)),n("div",me,d(m(r.value.net)),1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e($),{class:"text-base"},{default:a(()=>[...t[39]||(t[39]=[o("Funding Details",-1)])]),_:1})]),_:1}),s(e(_),{class:"grid gap-4 sm:grid-cols-2"},{default:a(()=>[n("div",null,[t[40]||(t[40]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Deposit Account",-1)),n("div",ce,d(r.value.depositAccount),1)]),n("div",null,[t[41]||(t[41]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Funded Date",-1)),n("div",pe,d(r.value.fundedDate?ct(r.value.fundedDate):"Pending"),1)]),n("div",null,[t[42]||(t[42]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Transactions",-1)),n("div",ve,d(r.value.transactions),1)]),n("div",null,[t[43]||(t[43]=n("div",{class:"text-xs text-muted-foreground uppercase"},"Currency",-1)),n("div",_e,d(r.value.currency),1)])]),_:1})]),_:1}),s(e(v),{class:"card-compact"},{default:a(()=>[s(e(w),{class:"pb-2"},{default:a(()=>[s(e($),{class:"text-base"},{default:a(()=>[...t[44]||(t[44]=[o("Notes",-1)])]),_:1})]),_:1}),s(e(_),null,{default:a(()=>[n("p",xe,d(r.value.notes||"No additional notes provided."),1),n("div",ge,[r.value.riskHold?(i(),C(e(It),{key:0,variant:"outline"},{default:a(()=>[...t[45]||(t[45]=[o("Risk Hold",-1)])]),_:1})):P("",!0),s(e(M),{variant:"link",class:"px-0",onClick:t[5]||(t[5]=l=>Y(r.value))},{default:a(()=>[...t[46]||(t[46]=[o(" View statement ",-1)])]),_:1})])]),_:1})]),_:1})])])):P("",!0)]),_:1})]),_:1},8,["open"])]))}});export{Ne as default};
